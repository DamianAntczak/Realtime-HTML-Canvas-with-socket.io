<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
            integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
            crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io();
    </script>
    <script>
        var mouse = {
            x:0,
            y:0,
            last_x:0,
            last_y:0,
            isPressed:false
        };

        function init() {
            canvas = document.getElementById('canvas');
            ctx = document.getElementById('canvas').getContext('2d');


            $('#canvas').mousedown(function (e) {
                mouse.isPressed = true;
                getCursorPosition(e);
                draw(mouse, false);
            });

            $('#canvas').mousemove(function (e) {
                getCursorPosition(e);
                if(mouse.isPressed) {
                    draw(mouse, true);
                }
            });

            $('#canvas').mouseup(function (e) {
                mouse.isPressed = false;
            });

        }
        
        function drawDot(x,y,size,ctx){
            ctx.beginPath();
            ctx.arc(x, y, size, 0, Math.PI*2, true);
            ctx.closePath();
            ctx.fill();
        }

        function draw(mouse, isDown) {
            console.log(mouse.last_x);
            if(isDown === true) {
                ctx.beginPath();
                ctx.lineJoin = "round";
                ctx.lineWidth = 3;
                ctx.moveTo(mouse.x, mouse.y);
                ctx.lineTo(mouse.last_x, mouse.last_y);
                ctx.closePath();
                ctx.stroke();

                socket.emit('draw', { mouse: mouse, isDown: isDown});
            }
            mouse.last_x = mouse.x;
            mouse.last_y = mouse.y;
        }

        function clearCanvas(canvas,ctx) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            socket.emit('clear');
        }

        function getCursorPosition(e) {
            mouse.x = e.offsetX;
            mouse.y = e.offsetY;
        }

        socket.on('draw',function (data) {
           draw(data.mouse,data.isDown);
        });

        socket.on('clear',function () {
            clearCanvas(canvas,ctx);
        });
        
    </script>
    <title>Multi Paint</title>
</head>
<body onload="init();">
    <h1>Multi Paint</h1>
    <main>
        <canvas id="canvas" width="800" height="600" style="border:1px solid #000;">
        </canvas>
        <button onclick="clearCanvas(canvas,ctx)">Wyczyść</button>
    </main>
</body>
</html>